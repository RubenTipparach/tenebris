(function(){"use strict";var S=(t=>(t[t.AIR=0]="AIR",t[t.STONE=1]="STONE",t[t.DIRT=2]="DIRT",t[t.GRASS=3]="GRASS",t[t.WATER=4]="WATER",t[t.SAND=5]="SAND",t[t.WOOD=6]="WOOD",t[t.LEAVES=7]="LEAVES",t[t.ORE_COAL=8]="ORE_COAL",t[t.ORE_COPPER=9]="ORE_COPPER",t[t.ORE_IRON=10]="ORE_IRON",t[t.ORE_GOLD=11]="ORE_GOLD",t[t.ORE_LITHIUM=12]="ORE_LITHIUM",t[t.ORE_ALUMINUM=13]="ORE_ALUMINUM",t[t.ORE_COBALT=14]="ORE_COBALT",t[t.SNOW=15]="SNOW",t[t.DIRT_SNOW=16]="DIRT_SNOW",t[t.ICE=17]="ICE",t[t.FURNACE=18]="FURNACE",t[t.GLASS=19]="GLASS",t[t.COMPUTER=20]="COMPUTER",t[t.PRINTER_3D=21]="PRINTER_3D",t[t.MOON_ROCK=22]="MOON_ROCK",t))(S||{});function X(t,e,h,l){let o=t*374761393+e*668265263+h*1274126177+l|0;return o=(o^o>>13)*1274126177|0,o^o>>16}function C(t,e,h,l,o,r,d){const n=X(t,e,h,d)&15,a=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1],[1,1,0],[-1,1,0],[0,-1,1],[0,-1,-1]][n];return a[0]*l+a[1]*o+a[2]*r}function q(t,e,h,l){const o=.3333333333333333,r=1/6;t+=l*.1,e+=l*.13,h+=l*.17;const d=(t+e+h)*o,n=Math.floor(t+d),s=Math.floor(e+d),a=Math.floor(h+d),i=(n+s+a)*r,f=n-i,D=s-i,R=a-i,c=t-f,u=e-D,O=h-R;let E,m,M,I,p,b;c>=u?u>=O?(E=1,m=0,M=0,I=1,p=1,b=0):c>=O?(E=1,m=0,M=0,I=1,p=0,b=1):(E=0,m=0,M=1,I=1,p=0,b=1):u<O?(E=0,m=0,M=1,I=0,p=1,b=1):c<O?(E=0,m=1,M=0,I=0,p=1,b=1):(E=0,m=1,M=0,I=1,p=1,b=0);const g=c-E+r,w=u-m+r,V=O-M+r,v=c-I+2*r,U=u-p+2*r,G=O-b+2*r,z=c-1+3*r,F=u-1+3*r,$=O-1+3*r;let x=0,j=0,K=0,Y=0,A=.6-c*c-u*u-O*O;A>=0&&(A*=A,x=A*A*C(n,s,a,c,u,O,l));let N=.6-g*g-w*w-V*V;N>=0&&(N*=N,j=N*N*C(n+E,s+m,a+M,g,w,V,l));let _=.6-v*v-U*U-G*G;_>=0&&(_*=_,K=_*_*C(n+I,s+p,a+b,v,U,G,l));let L=.6-z*z-F*F-$*$;return L>=0&&(L*=L,Y=L*L*C(n+1,s+1,a+1,z,F,$,l)),32*(x+j+K+Y)}function W(t,e,h,l,o,r,d,n){let s=0,a=1,i=l,f=0;for(let D=0;D<o;D++)s+=q(t*i,e*i,h*i,n)*a,f+=a,a*=r,i*=d;return s/f}function Z(t,e,h,l,o,r,d,n){let s=0,a=1,i=l,f=0;for(let D=0;D<o;D++){const R=q(t*i,e*i,h*i,n),c=1-Math.abs(R);s+=c*c*a,f+=a,a*=r,i*=d}return s/f}function J(t,e){const h=e.heightVariation,l=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),o=t.x/l,r=t.y/l,d=t.z/l,n=W(o,r,d,e.continentScale,6,.5,2,e.seed),s=Math.sign(n)*Math.pow(Math.abs(n),.8),a=Z(o,r,d,e.mountainScale,4,.5,2.2,e.seed),i=Math.max(0,s),f=a*i*e.mountainHeight,D=W(o,r,d,e.hillScale,3,.5,2,e.seed),R=W(o,r,d,e.detailScale,2,.5,2,e.seed);let c=s*e.continentWeight;c+=f,c+=D*e.hillWeight*(i>.1?1:.3),c+=R*e.detailWeight;const u=e.maxDepth-1-e.seaLevel;let O;if(c>=0){const E=c*e.maxHeight*h;O=u+E}else{const m=Math.pow(Math.abs(c),e.oceanDepthPower)*e.terrainMaxDepth*h;O=u-m}return Math.max(0,Math.min(e.maxDepth-1,Math.round(O)))}function P(t){const e=Math.sin(t)*43758.5453;return e-Math.floor(e)}function Q(t,e){const h=new Map,l=new Map;for(const o of t)l.set(o.index,o.neighbors);for(const o of e.oreConfigs){const r=o.type*31337;for(const d of t){const n=d.index;for(let s=o.minDepth;s<=o.maxDepth;s++){const a=`${n},${s}`;if(h.has(a))continue;const i=e.seed+r+n*7919+s*104729;P(i)<o.veinChance&&T(n,s,o,i,l,h)}}}return h}function T(t,e,h,l,o,r){const d=[],n=new Set;d.push({tileIndex:t,depth:e,probability:1});let s=0;const a=h.veinSize+Math.floor(P(l+999)*h.veinSize*.5);for(;d.length>0&&s<a;){const i=d.shift(),f=`${i.tileIndex},${i.depth}`;if(n.has(f)||(n.add(f),i.depth<h.minDepth||i.depth>h.maxDepth))continue;const D=l+i.tileIndex*13+i.depth*17;if(P(D)>i.probability||r.has(f))continue;r.set(f,h.type),s++;const R=i.probability*h.spreadFactor;if(R<.1)continue;d.push({tileIndex:i.tileIndex,depth:i.depth-1,probability:R}),d.push({tileIndex:i.tileIndex,depth:i.depth+1,probability:R});const c=o.get(i.tileIndex);if(c)for(const u of c)d.push({tileIndex:u,depth:i.depth,probability:R*.8})}}function y(t,e){const h=new Map,l=Q(t,e),o=new Map;for(const n of t){const s=J(n.center,e);o.set(n.index,s)}const r=e.maxDepth-1-e.seaLevel,d=new Set;if(e.hasWater){for(const n of t)if((o.get(n.index)??r)>=r){for(const a of n.neighbors)if((o.get(a)??r)<r){d.add(n.index);break}}}for(const n of t){const s=[],a=o.get(n.index)??r,i=d.has(n.index),f=Math.sqrt(n.center.x*n.center.x+n.center.y*n.center.y+n.center.z*n.center.z),D=n.center.y/f,R=!e.isSingleTexturePlanet&&Math.abs(D)>e.polarThreshold,c=e.hasWater&&a<r;for(let u=0;u<e.maxDepth;u++)if(u>a)s.push(S.AIR);else if(e.isSingleTexturePlanet)s.push(S.MOON_ROCK);else if(u===a)i&&!R?s.push(S.SAND):c?s.push(S.DIRT):R?s.push(S.SNOW):s.push(S.GRASS);else if(u>a-3)i&&!R?s.push(S.SAND):s.push(S.DIRT);else{const O=`${n.index},${u}`,E=l.get(O);E!==void 0?s.push(E):s.push(S.STONE)}h.set(n.index,s)}if(e.hasWater)for(const n of t){const s=h.get(n.index);for(let a=0;a<e.maxDepth;a++)s[a]===S.AIR&&a<=r&&(s[a]=S.WATER)}return h}self.onmessage=t=>{const{type:e,tiles:h,config:l}=t.data;if(e==="generateTerrain"){console.log(`[TerrainWorker] Generating terrain for ${h.length} tiles...`);const o=performance.now(),r=y(h,l),d=performance.now()-o;console.log(`[TerrainWorker] Generated terrain in ${d.toFixed(0)}ms`);const n={type:"terrainResult",columns:Array.from(r.entries())};self.postMessage(n)}}})();
//# sourceMappingURL=terrainGenerationWorker-c28lk6OV.js.map
