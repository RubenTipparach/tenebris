(function(){"use strict";var e=(t=>(t[t.AIR=0]="AIR",t[t.STONE=1]="STONE",t[t.DIRT=2]="DIRT",t[t.GRASS=3]="GRASS",t[t.WATER=4]="WATER",t[t.SAND=5]="SAND",t[t.WOOD=6]="WOOD",t[t.LEAVES=7]="LEAVES",t[t.ORE_COAL=8]="ORE_COAL",t[t.ORE_COPPER=9]="ORE_COPPER",t[t.ORE_IRON=10]="ORE_IRON",t[t.ORE_GOLD=11]="ORE_GOLD",t[t.ORE_LITHIUM=12]="ORE_LITHIUM",t[t.ORE_ALUMINUM=13]="ORE_ALUMINUM",t[t.ORE_COBALT=14]="ORE_COBALT",t))(e||{});function F(t,s,i){return{x:t,y:s,z:i}}function j(t){return{x:t.x,y:t.y,z:t.z}}function P(t,s){return{x:t.x-s.x,y:t.y-s.y,z:t.z-s.z}}function W(t,s){return{x:t.x*s,y:t.y*s,z:t.z*s}}function $(t,s){return t.x*s.x+t.y*s.y+t.z*s.z}function T(t,s){return{x:t.y*s.z-t.z*s.y,y:t.z*s.x-t.x*s.z,z:t.x*s.y-t.y*s.x}}function q(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function k(t){const s=q(t);return s===0?{x:0,y:0,z:0}:{x:t.x/s,y:t.y/s,z:t.z/s}}function J(t){return{x:-t.x,y:-t.y,z:-t.z}}function K(t,s){return q(P(t,s))}const Y=.8,Z=.05;function Q(t,s,i,v,h,l,R){if(i[h]!==e.WATER)return;const p=t.length,f=.001;for(let A=0;A<p;A++){const O=(A+1)%p,x=t[A],S=t[O];let L;for(const b of s){const _=v.get(b);if(!_)continue;let N=!1,c=!1;for(const U of _.vertices)K(U,x)<f&&(N=!0),K(U,S)<f&&(c=!0);if(N&&c){L=_;break}}if(!L||L.blocks[h]!==e.AIR)continue;const g=(h<i.length-1?i[h+1]:e.AIR)!==e.WATER,y=l.radius-(l.maxDepth-1-h)*l.blockHeight,E=g?y-l.waterSurfaceOffset:y,u=l.radius-(l.maxDepth-h)*l.blockHeight;if(u>=E)continue;const I=k(x),o=k(S),d=W(I,E),n=W(o,E),r=W(I,u),z=W(o,u),M=P(z,r),m=P(d,r),C=k(T(M,m)),G=R.vertexOffset;R.positions.push(r.x,r.y,r.z,z.x,z.y,z.z,n.x,n.y,n.z,d.x,d.y,d.z);for(let b=0;b<4;b++)R.normals.push(C.x,C.y,C.z);R.uvs.push(0,0,1,0,1,1,0,1),R.skyLight.push(1,1,1,1),R.colors.push(1,1,1,1,1,1,1,1,1,1,1,1),R.indices.push(G,G+1,G+2,G,G+2,G+3),R.vertexOffset+=4}}function D(){return{positions:[],normals:[],uvs:[],colors:[],skyLight:[],torchLight:[],indices:[],vertexOffset:0}}function X(t,s){return s.radius-(s.maxDepth-1-t)*s.blockHeight}function H(t,s,i,v){let h=0;for(const l of v){const R=t-l.position.x,p=s-l.position.y,f=i-l.position.z,A=Math.sqrt(R*R+p*p+f*f);if(A<l.range){const O=1/(1+2*A*A/(l.range*l.range));h+=O*l.intensity}}return Math.min(h,1.5)}function B(t,s,i){const v=t.blocks[s];if(v===e.AIR||v===e.WATER)return!1;for(const h of t.tile.neighbors){const l=i.get(h);if(!l)return!0;const R=l.blocks[s];if(R===void 0||R===e.AIR||R===e.WATER)return!0}return!1}function V(t,s,i,v,h,l,R,p=[]){const f=s.length/3,A=t.vertexOffset;t.positions.push.apply(t.positions,s),t.normals.push.apply(t.normals,i),t.uvs.push.apply(t.uvs,v);const O=new Array(f*3);for(let a=0;a<f;a++){const g=a*3;O[g]=1,O[g+1]=1,O[g+2]=1}t.colors.push.apply(t.colors,O);const x=new Array(f);for(let a=0;a<f;a++)x[a]=R;t.skyLight.push.apply(t.skyLight,x);const S=new Array(f);for(let a=0;a<f;a++){const g=s[a*3],y=s[a*3+1],E=s[a*3+2];S[a]=H(g,y,E,p)}t.torchLight.push.apply(t.torchLight,S);const L=new Array(h.length);for(let a=0;a<h.length;a++)L[a]=h[a]+A;t.indices.push.apply(t.indices,L),t.vertexOffset+=f}function w(t,s,i,v,h,l,R=10){const p=t.vertices.length,f=k(t.center),A=[],O=[];for(const o of t.vertices){const d=k(o);A.push(W(d,s)),O.push(W(d,i))}const x=W(f,s),S=W(f,i),L=j(f);let a=F(1,0,0);Math.abs($(L,a))>.9&&(a=F(0,0,1));const g=k(T(L,a));a=k(T(g,L));const y=[],E=[],u=[],I=[];if(v){const o=j(f);y.push(S.x,S.y,S.z),E.push(o.x,o.y,o.z),u.push(.5,.5);const d=.5;for(let n=0;n<p;n++){const r=O[n];y.push(r.x,r.y,r.z),E.push(o.x,o.y,o.z);const z=n/p*Math.PI*2-Math.PI/2,M=.5+Math.cos(z)*d,m=.5+Math.sin(z)*d;u.push(M,m)}for(let n=0;n<p;n++){const r=(n+1)%p;I.push(0,1+n,1+r)}}else if(h){const o=J(f);y.push(x.x,x.y,x.z),E.push(o.x,o.y,o.z),u.push(.5,.5);const d=.5;for(let n=0;n<p;n++){const r=A[n];y.push(r.x,r.y,r.z),E.push(o.x,o.y,o.z);const z=n/p*Math.PI*2-Math.PI/2,M=.5+Math.cos(z)*d,m=.5+Math.sin(z)*d;u.push(M,m)}for(let n=0;n<p;n++){const r=(n+1)%p;I.push(0,1+r,1+n)}}else if(l){let o=0;for(let d=0;d<p;d++){const n=(d+1)%p,r=O[d],z=O[n],M=A[d],m=A[n],C=P(m,M),G=P(r,M),b=k(T(C,G));y.push(M.x,M.y,M.z,m.x,m.y,m.z,z.x,z.y,z.z,r.x,r.y,r.z);for(let _=0;_<4;_++)E.push(b.x,b.y,b.z);u.push(0,0,1,0,1,1,0,1),I.push(o,o+1,o+2,o,o+2,o+3),o+=4}}return y.length===0?null:{positions:y,normals:E,uvs:u,indices:I}}function tt(t,s,i,v,h,l,R,p,f,A,O,x,S,L,a,g,y){let E=0;for(let u=t.blocks.length-1;u>=0;u--)if(t.blocks[u]!==e.AIR&&t.blocks[u]!==e.WATER){E=u;break}for(let u=0;u<t.blocks.length;u++){const I=t.blocks[u];if(I===e.AIR)continue;const o=I===e.WATER,d=u>=t.blocks.length-1?e.AIR:t.blocks[u+1],n=u===0?e.AIR:t.blocks[u-1],r=d===e.AIR||!o&&d===e.WATER,z=n===e.AIR||!o&&n===e.WATER;if(o&&d!==e.AIR)continue;const M=!o&&B(t,u,s);if(!o&&!r&&!z&&!M)continue;let m=X(u,i),C=m-i.blockHeight;if(o&&(m-=i.waterSurfaceOffset,C-=i.waterSurfaceOffset),C<=0)continue;const G=E-u;let b;switch(I){case e.ORE_COAL:b=O;break;case e.ORE_COPPER:b=x;break;case e.ORE_IRON:b=S;break;case e.ORE_GOLD:b=L;break;case e.ORE_LITHIUM:b=a;break;case e.ORE_ALUMINUM:b=g;break;case e.ORE_COBALT:b=y;break;case e.STONE:b=R;break;case e.SAND:b=p;break;case e.DIRT:b=h;break;case e.WOOD:b=f;break;default:b=v;break}let _=1;G>0&&(_=Math.max(Z,Math.pow(Y,G)));const N=i.torches||[];if(o||r){const c=w(t.tile,C,m,!0,!1,!1,i.uvScale);c&&(o?V(A,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,1,N):V(b,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,_,N))}if(!o&&z){const c=w(t.tile,C,m,!1,!0,!1,i.uvScale);if(c){const U=Math.max(Z,_*Y);I===e.GRASS?V(h,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,U,N):V(b,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,U,N)}}if(!o&&M){const c=w(t.tile,C,m,!1,!1,!0,i.uvScale);c&&(I===e.GRASS?V(l,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,_,N):V(b,c.positions,c.normals,c.uvs,c.indices,i.sunDirection,_,N))}}}self.onmessage=t=>{const{type:s,columns:i,neighborData:v,config:h}=t.data;if(s==="buildGeometry"){const l=D(),R=D(),p=D(),f=D(),A=D(),O=D(),x=D(),S=D(),L=D(),a=D(),g=D(),y=D(),E=D(),u=D(),I=new Map(Object.entries(v).map(([n,r])=>[parseInt(n),r]));for(const n of i){tt(n,I,h,l,R,p,f,A,O,x,S,L,a,g,y,E,u);for(let r=0;r<n.blocks.length;r++)n.blocks[r]===e.WATER&&Q(n.tile.vertices,n.tile.neighbors,n.blocks,I,r,h,x)}let o=0;for(const n of[l,R,p,f,A,O])o+=n.torchLight.filter(r=>r>0).length;(o>0||h.torches&&h.torches.length>0)&&console.log(`[GeometryWorker] Total non-zero torchLight values: ${o}`);const d={type:"geometryResult",topData:l,sideData:R,grassSideData:p,stoneData:f,sandData:A,woodData:O,waterData:x,oreCoalData:S,oreCopperData:L,oreIronData:a,oreGoldData:g,oreLithiumData:y,oreAluminumData:E,oreCobaltData:u};self.postMessage(d)}}})();
//# sourceMappingURL=geometryWorker-DphM4B4t.js.map
