(function(){"use strict";var c=(s=>(s[s.AIR=0]="AIR",s[s.STONE=1]="STONE",s[s.DIRT=2]="DIRT",s[s.GRASS=3]="GRASS",s[s.WATER=4]="WATER",s[s.SAND=5]="SAND",s[s.WOOD=6]="WOOD",s[s.LEAVES=7]="LEAVES",s))(c||{});function P(s,o,e){return{x:s,y:o,z:e}}function j(s){return{x:s.x,y:s.y,z:s.z}}function C(s,o){return{x:s.x-o.x,y:s.y-o.y,z:s.z-o.z}}function V(s,o){return{x:s.x*o,y:s.y*o,z:s.z*o}}function X(s,o){return s.x*o.x+s.y*o.y+s.z*o.z}function F(s,o){return{x:s.y*o.z-s.z*o.y,y:s.z*o.x-s.x*o.z,z:s.x*o.y-s.y*o.x}}function w(s){return Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)}function G(s){const o=w(s);return o===0?{x:0,y:0,z:0}:{x:s.x/o,y:s.y/o,z:s.z/o}}function Z(s){return{x:-s.x,y:-s.y,z:-s.z}}function K(s,o){return w(C(s,o))}const Y=.8,q=.05;function $(s,o,e,g,a,M,I,n){const m=s.length,z=.001;for(let x=0;x<m;x++){const u=(x+1)%m,l=s[x],d=s[u];let f;for(const A of o){const L=g.get(A);if(!L)continue;let U=!1,J=!1;for(const Q of L.vertices)K(Q,l)<z&&(U=!0),K(Q,d)<z&&(J=!0);if(U&&J){f=L;break}}if(!f||f.blocks[a]!==c.AIR)continue;let R=a+1;for(let A=a+1;A<e.length;A++){const L=e[A];if(L!==c.AIR&&L!==c.WATER){R=A;break}}let k=a+1;for(let A=a+1;A<f.blocks.length;A++){const L=f.blocks[A];if(L!==c.AIR&&L!==c.WATER){k=A;break}else if(L===c.AIR)k=A+1;else break}const E=Math.min(R,k),O=M,D=I.radius-E*I.blockHeight;if(D>=O)continue;const i=G(l),y=G(d),r=V(i,O),h=V(y,O),b=V(i,D),v=V(y,D),p=C(v,b),t=C(r,b),W=G(F(p,t)),T=n.vertexOffset;n.positions.push(b.x,b.y,b.z,v.x,v.y,v.z,h.x,h.y,h.z,r.x,r.y,r.z);for(let A=0;A<4;A++)n.normals.push(W.x,W.y,W.z);n.uvs.push(0,0,1,0,1,1,0,1),n.skyLight.push(1,1,1,1),n.colors.push(1,1,1,1,1,1,1,1,1,1,1,1),n.indices.push(T,T+1,T+2,T,T+2,T+3),n.vertexOffset+=4}}function N(){return{positions:[],normals:[],uvs:[],colors:[],skyLight:[],indices:[],vertexOffset:0}}function B(s,o,e){const g=s.blocks[o];if(g===c.AIR||g===c.WATER)return!1;for(const a of s.tile.neighbors){const M=e.get(a);if(!M)return!0;const I=M.blocks[o];if(I===void 0||I===c.AIR||I===c.WATER)return!0}return!1}function S(s,o,e,g,a,M,I){const n=o.length/3,m=s.vertexOffset;s.positions.push.apply(s.positions,o),s.normals.push.apply(s.normals,e),s.uvs.push.apply(s.uvs,g);const z=new Array(n*3);for(let l=0;l<n;l++){const d=l*3;z[d]=1,z[d+1]=1,z[d+2]=1}s.colors.push.apply(s.colors,z);const x=new Array(n);for(let l=0;l<n;l++)x[l]=I;s.skyLight.push.apply(s.skyLight,x);const u=new Array(a.length);for(let l=0;l<a.length;l++)u[l]=a[l]+m;s.indices.push.apply(s.indices,u),s.vertexOffset+=n}function _(s,o,e,g,a,M,I=10){const n=s.vertices.length,m=G(s.center),z=[],x=[];for(const i of s.vertices){const y=G(i);z.push(V(y,o)),x.push(V(y,e))}const u=V(m,o),l=V(m,e),d=j(m);let f=P(1,0,0);Math.abs(X(d,f))>.9&&(f=P(0,0,1));const R=G(F(d,f));f=G(F(R,d));const k=[],E=[],O=[],D=[];if(g){const i=j(m);k.push(l.x,l.y,l.z),E.push(i.x,i.y,i.z),O.push(.5,.5);const y=.5;for(let r=0;r<n;r++){const h=x[r];k.push(h.x,h.y,h.z),E.push(i.x,i.y,i.z);const b=r/n*Math.PI*2-Math.PI/2,v=.5+Math.cos(b)*y,p=.5+Math.sin(b)*y;O.push(v,p)}for(let r=0;r<n;r++){const h=(r+1)%n;D.push(0,1+r,1+h)}}else if(a){const i=Z(m);k.push(u.x,u.y,u.z),E.push(i.x,i.y,i.z),O.push(.5,.5);const y=.5;for(let r=0;r<n;r++){const h=z[r];k.push(h.x,h.y,h.z),E.push(i.x,i.y,i.z);const b=r/n*Math.PI*2-Math.PI/2,v=.5+Math.cos(b)*y,p=.5+Math.sin(b)*y;O.push(v,p)}for(let r=0;r<n;r++){const h=(r+1)%n;D.push(0,1+h,1+r)}}else if(M){let i=0;for(let y=0;y<n;y++){const r=(y+1)%n,h=x[y],b=x[r],v=z[y],p=z[r],t=C(p,v),W=C(h,v),T=G(F(t,W));k.push(v.x,v.y,v.z,p.x,p.y,p.z,b.x,b.y,b.z,h.x,h.y,h.z);for(let A=0;A<4;A++)E.push(T.x,T.y,T.z);O.push(0,0,1,0,1,1,0,1),D.push(i,i+1,i+2,i,i+2,i+3),i+=4}}return k.length===0?null:{positions:k,normals:E,uvs:O,indices:D}}function H(s,o,e,g,a,M,I,n,m,z){let x=0;for(let u=0;u<s.blocks.length;u++)if(s.blocks[u]!==c.AIR&&s.blocks[u]!==c.WATER){x=u;break}for(let u=0;u<s.blocks.length;u++){const l=s.blocks[u];if(l===c.AIR)continue;const d=l===c.WATER,f=u===0?c.AIR:s.blocks[u-1],R=u>=s.blocks.length-1?c.AIR:s.blocks[u+1],k=f===c.AIR||!d&&f===c.WATER,E=R===c.AIR||!d&&R===c.WATER;if(d&&f!==c.AIR)continue;const O=!d&&B(s,u,o);if(!d&&!k&&!E&&!O)continue;let D=e.radius-u*e.blockHeight,i=D-e.blockHeight;if(d&&(D-=e.waterSurfaceOffset,i-=e.waterSurfaceOffset),i<=0)continue;const y=u-x,r=l===c.STONE,h=l===c.SAND,b=l===c.DIRT,v=l===c.WOOD;let p=1;if(y>0&&(p=Math.max(q,Math.pow(Y,y))),d||k){const t=_(s.tile,i,D,!0,!1,!1,e.uvScale);t&&(d?S(z,t.positions,t.normals,t.uvs,t.indices,e.sunDirection,1):S(r?I:h?n:b?a:v?m:g,t.positions,t.normals,t.uvs,t.indices,e.sunDirection,p))}if(!d&&E){const t=_(s.tile,i,D,!1,!0,!1,e.uvScale);if(t){const W=Math.max(q,p*Y);S(r?I:h?n:v?m:a,t.positions,t.normals,t.uvs,t.indices,e.sunDirection,W)}}if(!d&&O){const t=_(s.tile,i,D,!1,!1,!0,e.uvScale);t&&S(r?I:h?n:b?a:v?m:M,t.positions,t.normals,t.uvs,t.indices,e.sunDirection,p)}}}self.onmessage=s=>{const{type:o,columns:e,neighborData:g,config:a}=s.data;if(o==="buildGeometry"){const M=N(),I=N(),n=N(),m=N(),z=N(),x=N(),u=N(),l=new Map(Object.entries(g).map(([f,R])=>[parseInt(f),R]));for(const f of e){H(f,l,a,M,I,n,m,z,x,u);for(let R=0;R<f.blocks.length;R++)if(f.blocks[R]===c.WATER&&(R===0?c.AIR:f.blocks[R-1])===c.AIR){const E=a.radius-R*a.blockHeight-a.waterSurfaceOffset;$(f.tile.vertices,f.tile.neighbors,f.blocks,l,R,E,a,u)}}const d={type:"geometryResult",topData:M,sideData:I,grassSideData:n,stoneData:m,sandData:z,woodData:x,waterData:u};self.postMessage(d)}}})();
//# sourceMappingURL=geometryWorker-Bu6-0G6n.js.map
