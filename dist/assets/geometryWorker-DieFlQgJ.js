(function(){"use strict";var e=(t=>(t[t.AIR=0]="AIR",t[t.STONE=1]="STONE",t[t.DIRT=2]="DIRT",t[t.GRASS=3]="GRASS",t[t.WATER=4]="WATER",t[t.SAND=5]="SAND",t[t.WOOD=6]="WOOD",t[t.LEAVES=7]="LEAVES",t[t.ORE_COAL=8]="ORE_COAL",t[t.ORE_COPPER=9]="ORE_COPPER",t[t.ORE_IRON=10]="ORE_IRON",t[t.ORE_GOLD=11]="ORE_GOLD",t[t.ORE_LITHIUM=12]="ORE_LITHIUM",t[t.ORE_ALUMINUM=13]="ORE_ALUMINUM",t[t.ORE_COBALT=14]="ORE_COBALT",t))(e||{});function F(t,s,u){return{x:t,y:s,z:u}}function j(t){return{x:t.x,y:t.y,z:t.z}}function w(t,s){return{x:t.x-s.x,y:t.y-s.y,z:t.z-s.z}}function G(t,s){return{x:t.x*s,y:t.y*s,z:t.z*s}}function Z(t,s){return t.x*s.x+t.y*s.y+t.z*s.z}function U(t,s){return{x:t.y*s.z-t.z*s.y,y:t.z*s.x-t.x*s.z,z:t.x*s.y-t.y*s.x}}function q(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function N(t){const s=q(t);return s===0?{x:0,y:0,z:0}:{x:t.x/s,y:t.y/s,z:t.z/s}}function $(t){return{x:-t.x,y:-t.y,z:-t.z}}function K(t,s){return q(w(t,s))}const Y=.8,J=.05;function B(t,s,u,g,p,A,E,l){const f=t.length,I=.001;for(let b=0;b<f;b++){const M=(b+1)%f,_=t[b],k=t[M];let r;for(const R of s){const L=g.get(R);if(!L)continue;let c=!1,P=!1;for(const X of L.vertices)K(X,_)<I&&(c=!0),K(X,k)<I&&(P=!0);if(c&&P){r=L;break}}if(!r||r.blocks[p]!==e.AIR)continue;let v=0;for(let R=p-1;R>=0;R--){const L=u[R];if(L!==e.AIR&&L!==e.WATER){v=R;break}}let y=0;for(let R=p-1;R>=0;R--){const L=r.blocks[R];if(L!==e.AIR&&L!==e.WATER){y=R;break}}const x=Math.max(v,y),a=A,z=E.radius-(E.maxDepth-1-x)*E.blockHeight;if(z>=a)continue;const n=N(_),i=N(k),o=G(n,a),d=G(i,a),O=G(n,z),m=G(i,z),D=w(m,O),C=w(o,O),W=N(U(D,C)),h=l.vertexOffset;l.positions.push(O.x,O.y,O.z,m.x,m.y,m.z,d.x,d.y,d.z,o.x,o.y,o.z);for(let R=0;R<4;R++)l.normals.push(W.x,W.y,W.z);l.uvs.push(0,0,1,0,1,1,0,1),l.skyLight.push(1,1,1,1),l.colors.push(1,1,1,1,1,1,1,1,1,1,1,1),l.indices.push(h,h+1,h+2,h,h+2,h+3),l.vertexOffset+=4}}function S(){return{positions:[],normals:[],uvs:[],colors:[],skyLight:[],torchLight:[],indices:[],vertexOffset:0}}function Q(t,s){return s.radius-(s.maxDepth-1-t)*s.blockHeight}function H(t,s,u,g){let p=0;for(const A of g){const E=t-A.position.x,l=s-A.position.y,f=u-A.position.z,I=Math.sqrt(E*E+l*l+f*f);if(I<A.range){const b=1/(1+2*I*I/(A.range*A.range));p+=b*A.intensity}}return Math.min(p,1.5)}function tt(t,s,u){const g=t.blocks[s];if(g===e.AIR||g===e.WATER)return!1;for(const p of t.tile.neighbors){const A=u.get(p);if(!A)return!0;const E=A.blocks[s];if(E===void 0||E===e.AIR||E===e.WATER)return!0}return!1}function V(t,s,u,g,p,A,E,l=[]){const f=s.length/3,I=t.vertexOffset;t.positions.push.apply(t.positions,s),t.normals.push.apply(t.normals,u),t.uvs.push.apply(t.uvs,g);const b=new Array(f*3);for(let r=0;r<f;r++){const v=r*3;b[v]=1,b[v+1]=1,b[v+2]=1}t.colors.push.apply(t.colors,b);const M=new Array(f);for(let r=0;r<f;r++)M[r]=E;t.skyLight.push.apply(t.skyLight,M);const _=new Array(f);for(let r=0;r<f;r++){const v=s[r*3],y=s[r*3+1],x=s[r*3+2];_[r]=H(v,y,x,l)}t.torchLight.push.apply(t.torchLight,_);const k=new Array(p.length);for(let r=0;r<p.length;r++)k[r]=p[r]+I;t.indices.push.apply(t.indices,k),t.vertexOffset+=f}function T(t,s,u,g,p,A,E=10){const l=t.vertices.length,f=N(t.center),I=[],b=[];for(const n of t.vertices){const i=N(n);I.push(G(i,s)),b.push(G(i,u))}const M=G(f,s),_=G(f,u),k=j(f);let r=F(1,0,0);Math.abs(Z(k,r))>.9&&(r=F(0,0,1));const v=N(U(k,r));r=N(U(v,k));const y=[],x=[],a=[],z=[];if(g){const n=j(f);y.push(_.x,_.y,_.z),x.push(n.x,n.y,n.z),a.push(.5,.5);const i=.5;for(let o=0;o<l;o++){const d=b[o];y.push(d.x,d.y,d.z),x.push(n.x,n.y,n.z);const O=o/l*Math.PI*2-Math.PI/2,m=.5+Math.cos(O)*i,D=.5+Math.sin(O)*i;a.push(m,D)}for(let o=0;o<l;o++){const d=(o+1)%l;z.push(0,1+o,1+d)}}else if(p){const n=$(f);y.push(M.x,M.y,M.z),x.push(n.x,n.y,n.z),a.push(.5,.5);const i=.5;for(let o=0;o<l;o++){const d=I[o];y.push(d.x,d.y,d.z),x.push(n.x,n.y,n.z);const O=o/l*Math.PI*2-Math.PI/2,m=.5+Math.cos(O)*i,D=.5+Math.sin(O)*i;a.push(m,D)}for(let o=0;o<l;o++){const d=(o+1)%l;z.push(0,1+d,1+o)}}else if(A){let n=0;for(let i=0;i<l;i++){const o=(i+1)%l,d=b[i],O=b[o],m=I[i],D=I[o],C=w(D,m),W=w(d,m),h=N(U(C,W));y.push(m.x,m.y,m.z,D.x,D.y,D.z,O.x,O.y,O.z,d.x,d.y,d.z);for(let R=0;R<4;R++)x.push(h.x,h.y,h.z);a.push(0,0,1,0,1,1,0,1),z.push(n,n+1,n+2,n,n+2,n+3),n+=4}}return y.length===0?null:{positions:y,normals:x,uvs:a,indices:z}}function st(t,s,u,g,p,A,E,l,f,I,b,M,_,k,r,v,y){let x=0;for(let a=t.blocks.length-1;a>=0;a--)if(t.blocks[a]!==e.AIR&&t.blocks[a]!==e.WATER){x=a;break}for(let a=0;a<t.blocks.length;a++){const z=t.blocks[a];if(z===e.AIR)continue;const n=z===e.WATER,i=a>=t.blocks.length-1?e.AIR:t.blocks[a+1],o=a===0?e.AIR:t.blocks[a-1],d=i===e.AIR||!n&&i===e.WATER,O=o===e.AIR||!n&&o===e.WATER;if(n&&i!==e.AIR)continue;const m=!n&&tt(t,a,s);if(!n&&!d&&!O&&!m)continue;let D=Q(a,u),C=D-u.blockHeight;if(n&&(D-=u.waterSurfaceOffset,C-=u.waterSurfaceOffset),C<=0)continue;const W=x-a;let h;switch(z){case e.ORE_COAL:h=b;break;case e.ORE_COPPER:h=M;break;case e.ORE_IRON:h=_;break;case e.ORE_GOLD:h=k;break;case e.ORE_LITHIUM:h=r;break;case e.ORE_ALUMINUM:h=v;break;case e.ORE_COBALT:h=y;break;case e.STONE:h=E;break;case e.SAND:h=l;break;case e.DIRT:h=p;break;case e.WOOD:h=f;break;default:h=g;break}let R=1;W>0&&(R=Math.max(J,Math.pow(Y,W)));const L=u.torches||[];if(n||d){const c=T(t.tile,C,D,!0,!1,!1,u.uvScale);c&&(n?V(I,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,1,L):V(h,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,R,L))}if(!n&&O){const c=T(t.tile,C,D,!1,!0,!1,u.uvScale);if(c){const P=Math.max(J,R*Y);z===e.GRASS?V(p,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,P,L):V(h,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,P,L)}}if(!n&&m){const c=T(t.tile,C,D,!1,!1,!0,u.uvScale);c&&(z===e.GRASS?V(A,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,R,L):V(h,c.positions,c.normals,c.uvs,c.indices,u.sunDirection,R,L))}}}self.onmessage=t=>{const{type:s,columns:u,neighborData:g,config:p}=t.data;if(s==="buildGeometry"){const A=S(),E=S(),l=S(),f=S(),I=S(),b=S(),M=S(),_=S(),k=S(),r=S(),v=S(),y=S(),x=S(),a=S(),z=new Map(Object.entries(g).map(([i,o])=>[parseInt(i),o]));for(const i of u){st(i,z,p,A,E,l,f,I,b,M,_,k,r,v,y,x,a);for(let o=0;o<i.blocks.length;o++)if(i.blocks[o]===e.WATER&&(o>=i.blocks.length-1?e.AIR:i.blocks[o+1])===e.AIR){const O=Q(o,p)-p.waterSurfaceOffset;B(i.tile.vertices,i.tile.neighbors,i.blocks,z,o,O,p,M)}}const n={type:"geometryResult",topData:A,sideData:E,grassSideData:l,stoneData:f,sandData:I,woodData:b,waterData:M,oreCoalData:_,oreCopperData:k,oreIronData:r,oreGoldData:v,oreLithiumData:y,oreAluminumData:x,oreCobaltData:a};self.postMessage(n)}}})();
//# sourceMappingURL=geometryWorker-DieFlQgJ.js.map
