{"version":3,"file":"terrainGenerationWorker-c28lk6OV.js","sources":["../src/shared/blockTypes.ts","../src/workers/terrainGenerationWorker.ts"],"sourcesContent":["// Shared block type definitions and helpers\r\n// This module is used by both main thread and web workers\r\n\r\nexport enum HexBlockType {\r\n  AIR = 0,\r\n  STONE = 1,\r\n  DIRT = 2,\r\n  GRASS = 3,\r\n  WATER = 4,\r\n  SAND = 5,\r\n  WOOD = 6,\r\n  LEAVES = 7,\r\n  // Mineral ores (underground)\r\n  ORE_COAL = 8,\r\n  ORE_COPPER = 9,\r\n  ORE_IRON = 10,\r\n  ORE_GOLD = 11,\r\n  ORE_LITHIUM = 12,\r\n  ORE_ALUMINUM = 13,\r\n  ORE_COBALT = 14,\r\n  // Snow biome blocks\r\n  SNOW = 15,\r\n  DIRT_SNOW = 16,  // Dirt with snow on top\r\n  ICE = 17,\r\n  // Technology blocks\r\n  FURNACE = 18,\r\n  // Glass (transparent like ice)\r\n  GLASS = 19,\r\n  // Advanced technology blocks\r\n  COMPUTER = 20,\r\n  PRINTER_3D = 21,\r\n  // Moon terrain block\r\n  MOON_ROCK = 22\r\n}\r\n\r\nexport function isSolid(blockType: HexBlockType | number): boolean {\r\n  return blockType !== HexBlockType.AIR && blockType !== HexBlockType.WATER;\r\n}\r\n\r\nexport function isLiquid(blockType: HexBlockType | number): boolean {\r\n  return blockType === HexBlockType.WATER;\r\n}\r\n\r\nexport function isTransparent(blockType: HexBlockType | number): boolean {\r\n  return blockType === HexBlockType.AIR || blockType === HexBlockType.WATER || blockType === HexBlockType.ICE || blockType === HexBlockType.GLASS;\r\n}\r\n\r\nexport function isSemiTransparent(blockType: HexBlockType | number): boolean {\r\n  return blockType === HexBlockType.ICE || blockType === HexBlockType.GLASS;\r\n}\r\n","// Terrain Generation Worker - generates planet terrain blocks off the main thread\r\n// This allows planet initialization to happen without blocking the UI\r\n\r\nimport { HexBlockType } from '../shared/blockTypes';\r\nimport { Vec3 } from '../shared/vec3';\r\n\r\n// Tile data passed from main thread (serializable)\r\ninterface TileData {\r\n  index: number;\r\n  center: Vec3;  // Normalized center position\r\n  neighbors: number[];\r\n}\r\n\r\n// Planet config passed from main thread\r\ninterface TerrainConfig {\r\n  seed: number;\r\n  maxDepth: number;\r\n  seaLevel: number;\r\n  maxHeight: number;\r\n  hasWater: boolean;\r\n  isSingleTexturePlanet: boolean;  // Moon-like planets\r\n  heightVariation: number;\r\n  polarThreshold: number;\r\n  // Terrain generation parameters\r\n  continentScale: number;\r\n  mountainScale: number;\r\n  hillScale: number;\r\n  detailScale: number;\r\n  continentWeight: number;\r\n  mountainHeight: number;\r\n  hillWeight: number;\r\n  detailWeight: number;\r\n  oceanDepthPower: number;\r\n  terrainMaxDepth: number;\r\n  // Ore configs\r\n  oreConfigs: OreConfig[];\r\n}\r\n\r\ninterface OreConfig {\r\n  type: number;  // HexBlockType value\r\n  minDepth: number;\r\n  maxDepth: number;\r\n  veinChance: number;\r\n  veinSize: number;\r\n  spreadFactor: number;\r\n}\r\n\r\n// Message types\r\ninterface GenerateTerrainMessage {\r\n  type: 'generateTerrain';\r\n  tiles: TileData[];\r\n  config: TerrainConfig;\r\n}\r\n\r\n// Result format for postMessage (Maps don't serialize well)\r\ninterface SerializableTerrainResult {\r\n  type: 'terrainResult';\r\n  columns: Array<[number, number[]]>;  // Array of [tileIndex, blocks] pairs\r\n}\r\n\r\n// ============ NOISE FUNCTIONS ============\r\n// These are pure functions that don't depend on any external state\r\n\r\nfunction hash3D(x: number, y: number, z: number, seed: number): number {\r\n  let h = (x * 374761393 + y * 668265263 + z * 1274126177 + seed) | 0;\r\n  h = ((h ^ (h >> 13)) * 1274126177) | 0;\r\n  return h ^ (h >> 16);\r\n}\r\n\r\nfunction grad3D(ix: number, iy: number, iz: number, x: number, y: number, z: number, seed: number): number {\r\n  const hash = hash3D(ix, iy, iz, seed) & 15;\r\n  const gradients = [\r\n    [1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0],\r\n    [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1],\r\n    [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1],\r\n    [1, 1, 0], [-1, 1, 0], [0, -1, 1], [0, -1, -1]\r\n  ];\r\n  const g = gradients[hash];\r\n  return g[0] * x + g[1] * y + g[2] * z;\r\n}\r\n\r\nfunction simplex3D(x: number, y: number, z: number, seed: number): number {\r\n  const F3 = 1.0 / 3.0;\r\n  const G3 = 1.0 / 6.0;\r\n\r\n  // Incorporate seed\r\n  x += seed * 0.1;\r\n  y += seed * 0.13;\r\n  z += seed * 0.17;\r\n\r\n  const s = (x + y + z) * F3;\r\n  const i = Math.floor(x + s);\r\n  const j = Math.floor(y + s);\r\n  const k = Math.floor(z + s);\r\n\r\n  const t = (i + j + k) * G3;\r\n  const X0 = i - t;\r\n  const Y0 = j - t;\r\n  const Z0 = k - t;\r\n\r\n  const x0 = x - X0;\r\n  const y0 = y - Y0;\r\n  const z0 = z - Z0;\r\n\r\n  let i1: number, j1: number, k1: number;\r\n  let i2: number, j2: number, k2: number;\r\n\r\n  if (x0 >= y0) {\r\n    if (y0 >= z0) {\r\n      i1 = 1; j1 = 0; k1 = 0; i2 = 1; j2 = 1; k2 = 0;\r\n    } else if (x0 >= z0) {\r\n      i1 = 1; j1 = 0; k1 = 0; i2 = 1; j2 = 0; k2 = 1;\r\n    } else {\r\n      i1 = 0; j1 = 0; k1 = 1; i2 = 1; j2 = 0; k2 = 1;\r\n    }\r\n  } else {\r\n    if (y0 < z0) {\r\n      i1 = 0; j1 = 0; k1 = 1; i2 = 0; j2 = 1; k2 = 1;\r\n    } else if (x0 < z0) {\r\n      i1 = 0; j1 = 1; k1 = 0; i2 = 0; j2 = 1; k2 = 1;\r\n    } else {\r\n      i1 = 0; j1 = 1; k1 = 0; i2 = 1; j2 = 1; k2 = 0;\r\n    }\r\n  }\r\n\r\n  const x1 = x0 - i1 + G3;\r\n  const y1 = y0 - j1 + G3;\r\n  const z1 = z0 - k1 + G3;\r\n  const x2 = x0 - i2 + 2.0 * G3;\r\n  const y2 = y0 - j2 + 2.0 * G3;\r\n  const z2 = z0 - k2 + 2.0 * G3;\r\n  const x3 = x0 - 1.0 + 3.0 * G3;\r\n  const y3 = y0 - 1.0 + 3.0 * G3;\r\n  const z3 = z0 - 1.0 + 3.0 * G3;\r\n\r\n  let n0 = 0, n1 = 0, n2 = 0, n3 = 0;\r\n\r\n  let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n  if (t0 >= 0) {\r\n    t0 *= t0;\r\n    n0 = t0 * t0 * grad3D(i, j, k, x0, y0, z0, seed);\r\n  }\r\n\r\n  let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n  if (t1 >= 0) {\r\n    t1 *= t1;\r\n    n1 = t1 * t1 * grad3D(i + i1, j + j1, k + k1, x1, y1, z1, seed);\r\n  }\r\n\r\n  let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n  if (t2 >= 0) {\r\n    t2 *= t2;\r\n    n2 = t2 * t2 * grad3D(i + i2, j + j2, k + k2, x2, y2, z2, seed);\r\n  }\r\n\r\n  let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n  if (t3 >= 0) {\r\n    t3 *= t3;\r\n    n3 = t3 * t3 * grad3D(i + 1, j + 1, k + 1, x3, y3, z3, seed);\r\n  }\r\n\r\n  return 32.0 * (n0 + n1 + n2 + n3);\r\n}\r\n\r\nfunction fractalSimplex3D(\r\n  x: number, y: number, z: number,\r\n  period: number,\r\n  octaves: number,\r\n  persistence: number,\r\n  lacunarity: number,\r\n  seed: number\r\n): number {\r\n  let value = 0;\r\n  let amplitude = 1;\r\n  let frequency = period;\r\n  let maxValue = 0;\r\n\r\n  for (let i = 0; i < octaves; i++) {\r\n    value += simplex3D(x * frequency, y * frequency, z * frequency, seed) * amplitude;\r\n    maxValue += amplitude;\r\n    amplitude *= persistence;\r\n    frequency *= lacunarity;\r\n  }\r\n\r\n  return value / maxValue;\r\n}\r\n\r\nfunction ridgeSimplex3D(\r\n  x: number, y: number, z: number,\r\n  period: number,\r\n  octaves: number,\r\n  persistence: number,\r\n  lacunarity: number,\r\n  seed: number\r\n): number {\r\n  let value = 0;\r\n  let amplitude = 1;\r\n  let frequency = period;\r\n  let maxValue = 0;\r\n\r\n  for (let i = 0; i < octaves; i++) {\r\n    const noise = simplex3D(x * frequency, y * frequency, z * frequency, seed);\r\n    const ridge = 1.0 - Math.abs(noise);\r\n    value += ridge * ridge * amplitude;\r\n    maxValue += amplitude;\r\n    amplitude *= persistence;\r\n    frequency *= lacunarity;\r\n  }\r\n\r\n  return value / maxValue;\r\n}\r\n\r\n// ============ HEIGHT VARIATION ============\r\n\r\nfunction getHeightVariation(center: Vec3, config: TerrainConfig): number {\r\n  const variation = config.heightVariation;\r\n  const len = Math.sqrt(center.x * center.x + center.y * center.y + center.z * center.z);\r\n  const dirX = center.x / len;\r\n  const dirY = center.y / len;\r\n  const dirZ = center.z / len;\r\n\r\n  // Layer 1: Continental Base\r\n  const continentNoise = fractalSimplex3D(\r\n    dirX, dirY, dirZ,\r\n    config.continentScale,\r\n    6, 0.5, 2.0,\r\n    config.seed\r\n  );\r\n  const continentValue = Math.sign(continentNoise) * Math.pow(Math.abs(continentNoise), 0.8);\r\n\r\n  // Layer 2: Mountain Ridges\r\n  const mountainNoise = ridgeSimplex3D(\r\n    dirX, dirY, dirZ,\r\n    config.mountainScale,\r\n    4, 0.5, 2.2,\r\n    config.seed\r\n  );\r\n  const landFactor = Math.max(0, continentValue);\r\n  const mountainHeight = mountainNoise * landFactor * config.mountainHeight;\r\n\r\n  // Layer 3: Hills and Variation\r\n  const hillNoise = fractalSimplex3D(\r\n    dirX, dirY, dirZ,\r\n    config.hillScale,\r\n    3, 0.5, 2.0,\r\n    config.seed\r\n  );\r\n\r\n  // Layer 4: Surface Detail\r\n  const detailNoise = fractalSimplex3D(\r\n    dirX, dirY, dirZ,\r\n    config.detailScale,\r\n    2, 0.5, 2.0,\r\n    config.seed\r\n  );\r\n\r\n  // Combine all layers\r\n  let height = continentValue * config.continentWeight;\r\n  height += mountainHeight;\r\n  height += hillNoise * config.hillWeight * (landFactor > 0.1 ? 1.0 : 0.3);\r\n  height += detailNoise * config.detailWeight;\r\n\r\n  // Convert height to depth\r\n  const SEA_LEVEL_DEPTH = config.maxDepth - 1 - config.seaLevel;\r\n\r\n  let depth: number;\r\n  if (height >= 0) {\r\n    const landHeight = height * config.maxHeight * variation;\r\n    depth = SEA_LEVEL_DEPTH + landHeight;\r\n  } else {\r\n    const oceanFactor = Math.pow(Math.abs(height), config.oceanDepthPower);\r\n    const oceanDepth = oceanFactor * config.terrainMaxDepth * variation;\r\n    depth = SEA_LEVEL_DEPTH - oceanDepth;\r\n  }\r\n\r\n  return Math.max(0, Math.min(config.maxDepth - 1, Math.round(depth)));\r\n}\r\n\r\n// ============ ORE GENERATION ============\r\n\r\nfunction seededRandom(seed: number): number {\r\n  const x = Math.sin(seed) * 43758.5453;\r\n  return x - Math.floor(x);\r\n}\r\n\r\nfunction generateOreVeins(\r\n  tiles: TileData[],\r\n  config: TerrainConfig\r\n): Map<string, number> {\r\n  const oreVeinCache = new Map<string, number>();\r\n\r\n  // Build neighbor lookup\r\n  const tileNeighbors = new Map<number, number[]>();\r\n  for (const tile of tiles) {\r\n    tileNeighbors.set(tile.index, tile.neighbors);\r\n  }\r\n\r\n  // For each ore type, generate vein seed points\r\n  for (const oreConfig of config.oreConfigs) {\r\n    const oreSeedOffset = oreConfig.type * 31337;\r\n\r\n    for (const tile of tiles) {\r\n      const tileIndex = tile.index;\r\n      for (let depth = oreConfig.minDepth; depth <= oreConfig.maxDepth; depth++) {\r\n        const key = `${tileIndex},${depth}`;\r\n        if (oreVeinCache.has(key)) continue;\r\n\r\n        const seed = config.seed + oreSeedOffset + tileIndex * 7919 + depth * 104729;\r\n        const random = seededRandom(seed);\r\n\r\n        if (random < oreConfig.veinChance) {\r\n          spreadOreVein(tileIndex, depth, oreConfig, seed, tileNeighbors, oreVeinCache);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return oreVeinCache;\r\n}\r\n\r\nfunction spreadOreVein(\r\n  seedTileIndex: number,\r\n  seedDepth: number,\r\n  config: OreConfig,\r\n  baseSeed: number,\r\n  tileNeighbors: Map<number, number[]>,\r\n  oreVeinCache: Map<string, number>\r\n): void {\r\n  const toVisit: Array<{ tileIndex: number; depth: number; probability: number }> = [];\r\n  const visited = new Set<string>();\r\n\r\n  toVisit.push({ tileIndex: seedTileIndex, depth: seedDepth, probability: 1.0 });\r\n\r\n  let blocksPlaced = 0;\r\n  const maxBlocks = config.veinSize + Math.floor(seededRandom(baseSeed + 999) * config.veinSize * 0.5);\r\n\r\n  while (toVisit.length > 0 && blocksPlaced < maxBlocks) {\r\n    const current = toVisit.shift()!;\r\n    const key = `${current.tileIndex},${current.depth}`;\r\n\r\n    if (visited.has(key)) continue;\r\n    visited.add(key);\r\n\r\n    if (current.depth < config.minDepth || current.depth > config.maxDepth) continue;\r\n\r\n    const placeSeed = baseSeed + current.tileIndex * 13 + current.depth * 17;\r\n    if (seededRandom(placeSeed) > current.probability) continue;\r\n\r\n    if (oreVeinCache.has(key)) continue;\r\n\r\n    oreVeinCache.set(key, config.type);\r\n    blocksPlaced++;\r\n\r\n    const neighborProb = current.probability * config.spreadFactor;\r\n    if (neighborProb < 0.1) continue;\r\n\r\n    // Spread to vertical neighbors\r\n    toVisit.push({ tileIndex: current.tileIndex, depth: current.depth - 1, probability: neighborProb });\r\n    toVisit.push({ tileIndex: current.tileIndex, depth: current.depth + 1, probability: neighborProb });\r\n\r\n    // Spread to horizontal neighbors\r\n    const neighbors = tileNeighbors.get(current.tileIndex);\r\n    if (neighbors) {\r\n      for (const neighborIdx of neighbors) {\r\n        toVisit.push({ tileIndex: neighborIdx, depth: current.depth, probability: neighborProb * 0.8 });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// ============ TERRAIN GENERATION ============\r\n\r\nfunction generateTerrain(tiles: TileData[], config: TerrainConfig): Map<number, number[]> {\r\n  const columns = new Map<number, number[]>();\r\n\r\n  // Generate ore veins first\r\n  const oreVeinCache = generateOreVeins(tiles, config);\r\n\r\n  // First pass: Generate height map\r\n  const heightMap = new Map<number, number>();\r\n  for (const tile of tiles) {\r\n    const surfaceDepth = getHeightVariation(tile.center, config);\r\n    heightMap.set(tile.index, surfaceDepth);\r\n  }\r\n\r\n  // Second pass: Identify beach tiles\r\n  const SEA_LEVEL_DEPTH = config.maxDepth - 1 - config.seaLevel;\r\n  const beachTiles = new Set<number>();\r\n\r\n  if (config.hasWater) {\r\n    for (const tile of tiles) {\r\n      const surfaceDepth = heightMap.get(tile.index) ?? SEA_LEVEL_DEPTH;\r\n      if (surfaceDepth >= SEA_LEVEL_DEPTH) {\r\n        for (const neighborIndex of tile.neighbors) {\r\n          const neighborDepth = heightMap.get(neighborIndex) ?? SEA_LEVEL_DEPTH;\r\n          if (neighborDepth < SEA_LEVEL_DEPTH) {\r\n            beachTiles.add(tile.index);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Third pass: Create blocks based on height map\r\n  for (const tile of tiles) {\r\n    const blocks: number[] = [];\r\n    const surfaceDepth = heightMap.get(tile.index) ?? SEA_LEVEL_DEPTH;\r\n    const isBeach = beachTiles.has(tile.index);\r\n\r\n    // Polar biome detection\r\n    const len = Math.sqrt(tile.center.x * tile.center.x + tile.center.y * tile.center.y + tile.center.z * tile.center.z);\r\n    const normalizedY = tile.center.y / len;\r\n    const isPolar = !config.isSingleTexturePlanet && Math.abs(normalizedY) > config.polarThreshold;\r\n    const isUnderwater = config.hasWater && surfaceDepth < SEA_LEVEL_DEPTH;\r\n\r\n    for (let depth = 0; depth < config.maxDepth; depth++) {\r\n      if (depth > surfaceDepth) {\r\n        blocks.push(HexBlockType.AIR);\r\n      } else if (config.isSingleTexturePlanet) {\r\n        blocks.push(HexBlockType.MOON_ROCK);\r\n      } else if (depth === surfaceDepth) {\r\n        if (isBeach && !isPolar) {\r\n          blocks.push(HexBlockType.SAND);\r\n        } else if (isUnderwater) {\r\n          blocks.push(HexBlockType.DIRT);\r\n        } else if (isPolar) {\r\n          blocks.push(HexBlockType.SNOW);\r\n        } else {\r\n          blocks.push(HexBlockType.GRASS);\r\n        }\r\n      } else if (depth > surfaceDepth - 3) {\r\n        if (isBeach && !isPolar) {\r\n          blocks.push(HexBlockType.SAND);\r\n        } else {\r\n          blocks.push(HexBlockType.DIRT);\r\n        }\r\n      } else {\r\n        // Deep underground = stone or ore\r\n        const key = `${tile.index},${depth}`;\r\n        const oreType = oreVeinCache.get(key);\r\n        if (oreType !== undefined) {\r\n          blocks.push(oreType);\r\n        } else {\r\n          blocks.push(HexBlockType.STONE);\r\n        }\r\n      }\r\n    }\r\n\r\n    columns.set(tile.index, blocks);\r\n  }\r\n\r\n  // Fill oceans with water\r\n  if (config.hasWater) {\r\n    for (const tile of tiles) {\r\n      const blocks = columns.get(tile.index)!;\r\n      for (let depth = 0; depth < config.maxDepth; depth++) {\r\n        if (blocks[depth] === HexBlockType.AIR && depth <= SEA_LEVEL_DEPTH) {\r\n          blocks[depth] = HexBlockType.WATER;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return columns;\r\n}\r\n\r\n// Worker message handler\r\nself.onmessage = (e: MessageEvent<GenerateTerrainMessage>) => {\r\n  const { type, tiles, config } = e.data;\r\n\r\n  if (type === 'generateTerrain') {\r\n    console.log(`[TerrainWorker] Generating terrain for ${tiles.length} tiles...`);\r\n    const startTime = performance.now();\r\n\r\n    const columns = generateTerrain(tiles, config);\r\n\r\n    const elapsed = performance.now() - startTime;\r\n    console.log(`[TerrainWorker] Generated terrain in ${elapsed.toFixed(0)}ms`);\r\n\r\n    // Convert Map to array for serialization\r\n    const result: SerializableTerrainResult = {\r\n      type: 'terrainResult',\r\n      columns: Array.from(columns.entries())\r\n    };\r\n\r\n    self.postMessage(result);\r\n  }\r\n};\r\n\r\nexport {};\r\n"],"names":["HexBlockType","hash3D","x","y","z","seed","h","grad3D","ix","iy","iz","hash","g","simplex3D","F3","G3","s","i","j","k","t","X0","Y0","Z0","x0","y0","z0","i1","j1","k1","i2","j2","k2","x1","y1","z1","x2","y2","z2","x3","y3","z3","n0","n1","n2","n3","t0","t1","t2","t3","fractalSimplex3D","period","octaves","persistence","lacunarity","value","amplitude","frequency","maxValue","ridgeSimplex3D","noise","ridge","getHeightVariation","center","config","variation","len","dirX","dirY","dirZ","continentNoise","continentValue","mountainNoise","landFactor","mountainHeight","hillNoise","detailNoise","height","SEA_LEVEL_DEPTH","depth","landHeight","oceanDepth","seededRandom","generateOreVeins","tiles","oreVeinCache","tileNeighbors","tile","oreConfig","oreSeedOffset","tileIndex","key","spreadOreVein","seedTileIndex","seedDepth","baseSeed","toVisit","visited","blocksPlaced","maxBlocks","current","placeSeed","neighborProb","neighbors","neighborIdx","generateTerrain","columns","heightMap","surfaceDepth","beachTiles","neighborIndex","blocks","isBeach","normalizedY","isPolar","isUnderwater","oreType","e","type","startTime","elapsed","result"],"mappings":"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"}