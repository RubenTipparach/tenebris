(function(){"use strict";var l=(s=>(s[s.AIR=0]="AIR",s[s.STONE=1]="STONE",s[s.DIRT=2]="DIRT",s[s.GRASS=3]="GRASS",s[s.WATER=4]="WATER",s[s.SAND=5]="SAND",s[s.WOOD=6]="WOOD",s[s.LEAVES=7]="LEAVES",s[s.ORE_COAL=8]="ORE_COAL",s[s.ORE_COPPER=9]="ORE_COPPER",s[s.ORE_IRON=10]="ORE_IRON",s[s.ORE_GOLD=11]="ORE_GOLD",s[s.ORE_LITHIUM=12]="ORE_LITHIUM",s[s.ORE_ALUMINUM=13]="ORE_ALUMINUM",s[s.ORE_COBALT=14]="ORE_COBALT",s))(l||{});function U(s,n,o){return{x:s,y:n,z:o}}function w(s){return{x:s.x,y:s.y,z:s.z}}function k(s,n){return{x:s.x-n.x,y:s.y-n.y,z:s.z-n.z}}function g(s,n){return{x:s.x*n,y:s.y*n,z:s.z*n}}function Z(s,n){return s.x*n.x+s.y*n.y+s.z*n.z}function P(s,n){return{x:s.y*n.z-s.z*n.y,y:s.z*n.x-s.x*n.z,z:s.x*n.y-s.y*n.x}}function F(s){return Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)}function C(s){const n=F(s);return n===0?{x:0,y:0,z:0}:{x:s.x/n,y:s.y/n,z:s.z/n}}function $(s){return{x:-s.x,y:-s.y,z:-s.z}}function j(s,n){return F(k(s,n))}const K=.8,Y=.05;function B(s,n,o,M,p,_,v,e){const O=s.length,I=.001;for(let A=0;A<O;A++){const c=(A+1)%O,u=s[A],a=s[c];let f;for(const z of n){const G=M.get(z);if(!G)continue;let J=!1,Q=!1;for(const X of G.vertices)j(X,u)<I&&(J=!0),j(X,a)<I&&(Q=!0);if(J&&Q){f=G;break}}if(!f||f.blocks[p]!==l.AIR)continue;let x=0;for(let z=p-1;z>=0;z--){const G=o[z];if(G!==l.AIR&&G!==l.WATER){x=z;break}}let y=0;for(let z=p-1;z>=0;z--){const G=f.blocks[z];if(G!==l.AIR&&G!==l.WATER){y=z;break}}const D=Math.max(x,y),L=_,S=v.radius-(v.maxDepth-1-D)*v.blockHeight;if(S>=L)continue;const i=C(u),R=C(a),r=g(i,L),h=g(R,L),b=g(i,S),m=g(R,S),d=k(m,b),t=k(r,b),W=C(P(d,t)),N=e.vertexOffset;e.positions.push(b.x,b.y,b.z,m.x,m.y,m.z,h.x,h.y,h.z,r.x,r.y,r.z);for(let z=0;z<4;z++)e.normals.push(W.x,W.y,W.z);e.uvs.push(0,0,1,0,1,1,0,1),e.skyLight.push(1,1,1,1),e.colors.push(1,1,1,1,1,1,1,1,1,1,1,1),e.indices.push(N,N+1,N+2,N,N+2,N+3),e.vertexOffset+=4}}function V(){return{positions:[],normals:[],uvs:[],colors:[],skyLight:[],indices:[],vertexOffset:0}}function q(s,n){return n.radius-(n.maxDepth-1-s)*n.blockHeight}function H(s,n,o){const M=s.blocks[n];if(M===l.AIR||M===l.WATER)return!1;for(const p of s.tile.neighbors){const _=o.get(p);if(!_)return!0;const v=_.blocks[n];if(v===void 0||v===l.AIR||v===l.WATER)return!0}return!1}function E(s,n,o,M,p,_,v){const e=n.length/3,O=s.vertexOffset;s.positions.push.apply(s.positions,n),s.normals.push.apply(s.normals,o),s.uvs.push.apply(s.uvs,M);const I=new Array(e*3);for(let u=0;u<e;u++){const a=u*3;I[a]=1,I[a+1]=1,I[a+2]=1}s.colors.push.apply(s.colors,I);const A=new Array(e);for(let u=0;u<e;u++)A[u]=v;s.skyLight.push.apply(s.skyLight,A);const c=new Array(p.length);for(let u=0;u<p.length;u++)c[u]=p[u]+O;s.indices.push.apply(s.indices,c),s.vertexOffset+=e}function T(s,n,o,M,p,_,v=10){const e=s.vertices.length,O=C(s.center),I=[],A=[];for(const i of s.vertices){const R=C(i);I.push(g(R,n)),A.push(g(R,o))}const c=g(O,n),u=g(O,o),a=w(O);let f=U(1,0,0);Math.abs(Z(a,f))>.9&&(f=U(0,0,1));const x=C(P(a,f));f=C(P(x,a));const y=[],D=[],L=[],S=[];if(M){const i=w(O);y.push(u.x,u.y,u.z),D.push(i.x,i.y,i.z),L.push(.5,.5);const R=.5;for(let r=0;r<e;r++){const h=A[r];y.push(h.x,h.y,h.z),D.push(i.x,i.y,i.z);const b=r/e*Math.PI*2-Math.PI/2,m=.5+Math.cos(b)*R,d=.5+Math.sin(b)*R;L.push(m,d)}for(let r=0;r<e;r++){const h=(r+1)%e;S.push(0,1+r,1+h)}}else if(p){const i=$(O);y.push(c.x,c.y,c.z),D.push(i.x,i.y,i.z),L.push(.5,.5);const R=.5;for(let r=0;r<e;r++){const h=I[r];y.push(h.x,h.y,h.z),D.push(i.x,i.y,i.z);const b=r/e*Math.PI*2-Math.PI/2,m=.5+Math.cos(b)*R,d=.5+Math.sin(b)*R;L.push(m,d)}for(let r=0;r<e;r++){const h=(r+1)%e;S.push(0,1+h,1+r)}}else if(_){let i=0;for(let R=0;R<e;R++){const r=(R+1)%e,h=A[R],b=A[r],m=I[R],d=I[r],t=k(d,m),W=k(h,m),N=C(P(t,W));y.push(m.x,m.y,m.z,d.x,d.y,d.z,b.x,b.y,b.z,h.x,h.y,h.z);for(let z=0;z<4;z++)D.push(N.x,N.y,N.z);L.push(0,0,1,0,1,1,0,1),S.push(i,i+1,i+2,i,i+2,i+3),i+=4}}return y.length===0?null:{positions:y,normals:D,uvs:L,indices:S}}function ss(s,n,o,M,p,_,v,e,O,I){let A=0;for(let c=s.blocks.length-1;c>=0;c--)if(s.blocks[c]!==l.AIR&&s.blocks[c]!==l.WATER){A=c;break}for(let c=0;c<s.blocks.length;c++){const u=s.blocks[c];if(u===l.AIR)continue;const a=u===l.WATER,f=c>=s.blocks.length-1?l.AIR:s.blocks[c+1],x=c===0?l.AIR:s.blocks[c-1],y=f===l.AIR||!a&&f===l.WATER,D=x===l.AIR||!a&&x===l.WATER;if(a&&f!==l.AIR)continue;const L=!a&&H(s,c,n);if(!a&&!y&&!D&&!L)continue;let S=q(c,o),i=S-o.blockHeight;if(a&&(S-=o.waterSurfaceOffset,i-=o.waterSurfaceOffset),i<=0)continue;const R=A-c,r=u===l.STONE,h=u===l.SAND,b=u===l.DIRT,m=u===l.WOOD;let d=1;if(R>0&&(d=Math.max(Y,Math.pow(K,R))),a||y){const t=T(s.tile,i,S,!0,!1,!1,o.uvScale);t&&(a?E(I,t.positions,t.normals,t.uvs,t.indices,o.sunDirection,1):E(r?v:h?e:b?p:m?O:M,t.positions,t.normals,t.uvs,t.indices,o.sunDirection,d))}if(!a&&D){const t=T(s.tile,i,S,!1,!0,!1,o.uvScale);if(t){const W=Math.max(Y,d*K);E(r?v:h?e:m?O:p,t.positions,t.normals,t.uvs,t.indices,o.sunDirection,W)}}if(!a&&L){const t=T(s.tile,i,S,!1,!1,!0,o.uvScale);t&&E(r?v:h?e:b?p:m?O:_,t.positions,t.normals,t.uvs,t.indices,o.sunDirection,d)}}}self.onmessage=s=>{const{type:n,columns:o,neighborData:M,config:p}=s.data;if(n==="buildGeometry"){const _=V(),v=V(),e=V(),O=V(),I=V(),A=V(),c=V(),u=new Map(Object.entries(M).map(([f,x])=>[parseInt(f),x]));for(const f of o){ss(f,u,p,_,v,e,O,I,A,c);for(let x=0;x<f.blocks.length;x++)if(f.blocks[x]===l.WATER&&(x>=f.blocks.length-1?l.AIR:f.blocks[x+1])===l.AIR){const D=q(x,p)-p.waterSurfaceOffset;B(f.tile.vertices,f.tile.neighbors,f.blocks,u,x,D,p,c)}}const a={type:"geometryResult",topData:_,sideData:v,grassSideData:e,stoneData:O,sandData:I,woodData:A,waterData:c};self.postMessage(a)}}})();
//# sourceMappingURL=geometryWorker-bOl0mFX9.js.map
